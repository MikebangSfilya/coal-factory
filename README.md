# Coal Factory

Учебный проект на Go, демонстрирующий работу с конкурентностью, интерфейсами и REST API через игровую механику.

Игровая симуляция горно-рудного производства в некой несуществующей реальности с поразительно низким уровнем технического развития, весь уголь до сих пор добывается вручную, а зарплата рабочим выдается их же добытой ценностью.

## Цель игры

Ваша цель за минимальное время улучшить условия труда бедных шахтёров, купив 3 вида оборудования:

- Кирки, ведь их забыл выдать прораб. Цена 3_000 угля
- Вентиляцию, иначе всех ваших бравых работяг настигнет пневмокониоз. Цена 15_000 угля
- Вагонетки, чтобы шахтеры не носили тонны угля в своих руках. Цена 50_000

**С моральной точки зрения -- все рабочие лишь набор инструкций, и даже если вам захочется вечно эксплуатировать рабочих ничего не произойдет, вы лишь будете жить в проклятом мире который сами и создали.**

## Запуск проекта

```bash
# Клонируем репозиторий
git clone https://github.com/MikebangSfilya/coal-factory
cd coal-factory

# Запуск сервера
go run ./main.go

# Сервер слушает на :8080
curl http://localhost:8080/miners
```

### Запуск тестового интерфейса (опционально)

Для удобного взаимодействия с API можно использовать встроенный тестовый UI:

1. Откройте файл `frontend/index.html` в браузере.
2. Взаимодействуйте с API через игровой интерфейс.

**ДИСКЛЕЙМЕР**: данный интерфейс предназначен исключительно для демонстрации работы API и не является полноценным фронтендом.

## Как играть

### Пассивный доход

С самого запуска нашего предприятия, волшебным образом мы получаем ровно одну единицу угля в одну секунду, никто не знает кто ее добывает и кто ее доставляет, вам нужно лишь знать, что вы никогда не останетесь без угля.

### Рабочие

К найму доступны 3 вида шахтеров, основные отличия в стоимости труда, их выносливости и количестве добытого ими угля

| Тип          | Стоимость | Доход    | Энергия | Скорость |
| ------------ | --------- | -------- | ------- | -------- |
| **Little**   | 5 угля    | 1 угля   | 30      | 3 сек    |
| **Normal**   | 50 угля   | 3 угля   | 45      | 2 сек    |
| **Powerful** | 450 угля  | 10+ угля | 60      | 1 сек    |

**Powerful** рабочий с каждой новой добычей угля улучшается и добывает больше угля. Три единицы дополнительной добычи за цикл до конца своей рабочей смены.

#### Наем рабочих

``` bash
# Нанять майнера
POST /miners
{
    "miner_type": "little"}  # little, normal, powerful
}
```

### Покупка оборудования

``` bash
# Купить кирку
POST /equipment/pick

# Купить вентиляцию  
POST /equipment/vent

# Купить вагонетку
POST /equipment/trolley
```

### Победа

Игра считается выигранной, когда вы приобрели все 3 вида оборудования:

- Кирка (3,000 угля)
- Вентиляция (15,000 угля)  
- Вагонетка (50,000 угля)

После этого вы становитесь образцовым работодателем в этой суровой реальности!

Проверить статус победы:

`GET /win`

## Эндпоинты

| Метод  | Эндпоинт        | Описание               | Ответ                         |
| ------ | --------------- | ---------------------- | ----------------------------- |
| `POST` | `/miners`       | Нанять рабочего        | JSON c `MinerInfo`            |
| `GET`  | `/miners/{id}`  | Информация о шахтёре   | JSON c `MinerInfo`            |
| `GET`  | `/miners`       | Список всех рабочих    | JSON со списком всех шахтёров |
| `GET`  | `/balance`      | Баланс угля            | `{ "balance": 123 }`          |
| `GET`  | `/items`        | Состояние оборудования | список предметов              |
| `POST` | `/items/{type}` | Купить предмет         | подтверждение покупки         |
| `GET`  | `/win`          | Проверка победы        | JSON с статистикой            |

**MinerInfo**:

```go
type MinerInfo struct {
    ID        uuid.UUID
    MinerType MinerType
    CoalPower Coal
    Energy    int64
    Cost      int64

}
```

## Технологии

- Go 1.24
- chi router
- goroutines, channels
- thread-safe атомарные операции
- structured logging (`slog`)
